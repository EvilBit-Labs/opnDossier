# Advanced Configuration Examples

This guide covers advanced configuration options and customization techniques for opnFocus.

## Custom Templates

### Creating Custom Templates

Create a custom template directory:

```bash
# Create template directory
mkdir -p ~/.opnFocus/templates

# Create a custom template
cat > ~/.opnFocus/templates/custom.md.tmpl << 'EOF'
# {{.System.Hostname}} Configuration Report

## Executive Summary
- **Hostname**: {{.System.Hostname}}
- **Domain**: {{.System.Domain}}
- **Generated**: {{.GeneratedAt}}

## Network Interfaces
{{range $name, $iface := .Interfaces}}
### {{$name}} Interface
- **IP Address**: {{$iface.IPAddress}}
- **Subnet**: /{{$iface.Subnet}}
- **Description**: {{$iface.Description}}
- **Enabled**: {{if $iface.Enabled}}Yes{{else}}No{{end}}
{{end}}

## Firewall Rules Summary
- **Total Rules**: {{len .Filter.Rules}}
- **WAN Rules**: {{.Filter.WANRuleCount}}
- **LAN Rules**: {{.Filter.LANRuleCount}}

## Security Assessment
{{if .SecurityIssues}}
### Critical Issues
{{range .SecurityIssues}}
- **{{.Title}}**: {{.Description}}
{{end}}
{{else}}
No critical security issues found.
{{end}}
EOF
```

### Using Custom Templates

```bash
# Use custom template
opnFocus convert config.xml --template-dir ~/.opnFocus/templates -o custom-report.md

# Use specific template
opnFocus convert config.xml --template custom -o custom-report.md

# Use template with custom data
opnFocus convert config.xml --template-dir ./templates --template-dir ~/.opnFocus/templates
```

### Advanced Template Features

#### Conditional Rendering

```markdown
{{if .System.Hostname}}
# {{.System.Hostname}} Configuration
{{else}}
# Unnamed Firewall Configuration
{{end}}

{{if gt (len .Filter.Rules) 10}}
## Large Rule Set Detected
This configuration has {{len .Filter.Rules}} firewall rules, which may impact performance.
{{end}}
```

#### Loops and Iteration

```markdown
## Interface Analysis
{{range $name, $iface := .Interfaces}}
### {{$name}} Interface
{{if eq $iface.IPAddress "dhcp"}}
- **Configuration**: DHCP
{{else}}
- **Configuration**: Static ({{$iface.IPAddress}}/{{$iface.Subnet}})
{{end}}
{{end}}
```

#### Template Functions

```markdown
## Statistics
- **Total Interfaces**: {{len .Interfaces}}
- **Total Rules**: {{len .Filter.Rules}}
- **Total Users**: {{len .System.Users}}
- **Total Groups**: {{len .System.Groups}}

## Network Summary
{{range $name, $iface := .Interfaces}}
- {{$name}}: {{$iface.IPAddress}}/{{$iface.Subnet}}
{{end}}
```

### Template Inheritance

Create a base template:

```markdown
# Base Template (base.md.tmpl)
{{define "base"}}
# {{.System.Hostname}} - {{.Title}}

{{template "header" .}}

{{template "content" .}}

{{template "footer" .}}
{{end}}

{{define "header"}}
Generated on {{.GeneratedAt}}
{{end}}

{{define "footer"}}
---
Report generated by opnFocus
{{end}}
```

Create a specialized template:

```markdown
# Security Template (security.md.tmpl)
{{template "base" .}}

{{define "content"}}
## Security Analysis
{{range .SecurityIssues}}
### {{.Title}}
- **Severity**: {{.Severity}}
- **Description**: {{.Description}}
- **Recommendation**: {{.Recommendation}}
{{end}}
{{end}}
```

## Theme Customization

### Built-in Themes

```bash
# Use light theme
opnFocus display config.xml --theme light

# Use dark theme
opnFocus display config.xml --theme dark

# Auto-detect theme
opnFocus display config.xml --theme auto

# No theme (plain text)
opnFocus display config.xml --theme none
```

### Custom Theme Configuration

Create a custom theme configuration:

```yaml
# ~/.opnFocus/themes/custom.yaml
colors:
  primary: '#2563eb'
  secondary: '#64748b'
  success: '#059669'
  warning: '#d97706'
  error: '#dc2626'
  background: '#ffffff'
  foreground: '#1f2937'

styles:
  header:
    bold: true
    color: primary
  subheader:
    color: secondary
  success:
    color: success
  warning:
    color: warning
  error:
    color: error
```

### Using Custom Themes

```bash
# Use custom theme
opnFocus display config.xml --theme custom

# Create theme-specific output
opnFocus display config.xml --theme dark --wrap 120
```

## Section Filtering

### Basic Section Filtering

```bash
# Display only system information
opnFocus display config.xml --section system

# Display network and firewall sections
opnFocus display config.xml --section network,firewall

# Display multiple sections
opnFocus display config.xml --section system,interfaces,firewall
```

### Advanced Section Filtering

```bash
# Filter by specific interface
opnFocus display config.xml --section interfaces.wan,interfaces.lan

# Filter by rule type
opnFocus display config.xml --section firewall.rules.pass,firewall.rules.block

# Filter by service
opnFocus display config.xml --section services.dhcp,services.dns
```

### Section Filtering with Templates

```bash
# Use custom template with specific sections
opnFocus convert config.xml \
    --template security \
    --section system,firewall,security \
    -o security-report.md
```

## Output Formatting

### Text Wrapping

```bash
# Set text wrap width
opnFocus display config.xml --wrap 80

# No text wrapping
opnFocus display config.xml --wrap 0

# Wide format for large screens
opnFocus display config.xml --wrap 160
```

### Custom Output Formats

#### JSON with Custom Structure

```bash
# Convert to JSON with specific structure
opnFocus convert config.xml -f json | jq '{
  hostname: .system.hostname,
  domain: .system.domain,
  interfaces: .interfaces,
  rule_count: (.filter.rules | length)
}'
```

#### YAML with Filtering

```bash
# Convert to YAML with specific sections
opnFocus convert config.xml -f yaml | yq '.system, .interfaces'
```

## Advanced Configuration Files

### Comprehensive Configuration

Create `~/.opnFocus.yaml`:

```yaml
# Global configuration
log_level: info
log_format: text
verbose: false
theme: auto

# Output settings
output_file: ./network-docs.md
wrap_width: 120

# Template settings
template_dir: ~/.opnFocus/templates
default_template: comprehensive

# Security settings
security_mode: blue
comprehensive_reports: true
plugins: [stig, sans]

# Display settings
sections: [system, interfaces, firewall, nat]
exclude_sections: [certificates, vpn]

# Performance settings
max_memory: 512MB
timeout: 300s
```

### Environment-Specific Configuration

Create `~/.opnFocus/production.yaml`:

```yaml
# Production environment settings
log_level: warn
log_format: json
output_file: /var/www/docs/network-config.md

# Security-focused settings
security_mode: blue
comprehensive_reports: true
plugins: [stig, sans, firewall]

# Performance settings
max_memory: 1GB
timeout: 600s
```

Create `~/.opnFocus/development.yaml`:

```yaml
# Development environment settings
log_level: debug
log_format: text
verbose: true
output_file: ./dev-docs.md

# Debug settings
security_mode: standard
comprehensive_reports: false
plugins: []

# Performance settings
max_memory: 256MB
timeout: 60s
```

### Using Environment-Specific Configs

```bash
# Use production configuration
opnFocus --config ~/.opnFocus/production.yaml convert config.xml

# Use development configuration
opnFocus --config ~/.opnFocus/development.yaml convert config.xml

# Override specific settings
opnFocus --config ~/.opnFocus/production.yaml --log_level=debug convert config.xml
```

## Plugin Configuration

### Custom Plugin Configuration

Create plugin configuration:

```yaml
# ~/.opnFocus/plugins.yaml
plugins:
  stig:
    enabled: true
    strict_mode: true
    custom_controls:
      - id: STIG-CUSTOM-001
        title: Custom SSH Configuration
        description: Custom SSH security requirements
        severity: high
        check: ssh_config_check

  sans:
    enabled: true
    controls:
      - CIS-1.1
      - CIS-1.2
      - CIS-2.1

  firewall:
    enabled: true
    custom_rules:
      - name: Custom Rule Check
        description: Check for custom security rules
        severity: medium
```

### Using Custom Plugin Configuration

```bash
# Use custom plugin configuration
opnFocus convert config.xml \
    --plugins stig,sans \
    --plugin-config ~/.opnFocus/plugins.yaml \
    -o compliance-report.md
```

## Advanced Workflows

### Multi-Format Generation

```bash
#!/bin/bash
# multi-format-generator.sh

CONFIG_FILE="$1"
OUTPUT_DIR="$2"

# Create output directory
mkdir -p "$OUTPUT_DIR"

# Generate multiple formats
opnFocus convert "$CONFIG_FILE" -o "$OUTPUT_DIR/network-config.md"
opnFocus convert "$CONFIG_FILE" -f json -o "$OUTPUT_DIR/network-config.json"
opnFocus convert "$CONFIG_FILE" -f yaml -o "$OUTPUT_DIR/network-config.yaml"

# Generate security reports
opnFocus convert "$CONFIG_FILE" \
    --mode blue --comprehensive \
    --plugins stig,sans \
    -o "$OUTPUT_DIR/security-audit.md"

opnFocus convert "$CONFIG_FILE" \
    --mode red --blackhat-mode \
    -o "$OUTPUT_DIR/attack-surface.md"

echo "Multi-format generation completed in $OUTPUT_DIR"
```

### Template-Based Workflows

```bash
#!/bin/bash
# template-workflow.sh

CONFIG_FILE="$1"
TEMPLATE_DIR="$2"

# Generate executive summary
opnFocus convert "$CONFIG_FILE" \
    --template executive \
    --template-dir "$TEMPLATE_DIR" \
    -o executive-summary.md

# Generate technical report
opnFocus convert "$CONFIG_FILE" \
    --template technical \
    --template-dir "$TEMPLATE_DIR" \
    -o technical-report.md

# Generate compliance report
opnFocus convert "$CONFIG_FILE" \
    --template compliance \
    --template-dir "$TEMPLATE_DIR" \
    --plugins stig,sans \
    -o compliance-report.md
```

### Conditional Processing

```bash
#!/bin/bash
# conditional-processing.sh

CONFIG_FILE="$1"

# Check file size
FILE_SIZE=$(stat -c%s "$CONFIG_FILE")

if [ "$FILE_SIZE" -gt 1048576 ]; then
    # Large file - use optimized settings
    opnFocus convert "$CONFIG_FILE" \
        --max-memory 1GB \
        --timeout 600s \
        -o large-config-report.md
else
    # Small file - use standard settings
    opnFocus convert "$CONFIG_FILE" \
        --comprehensive \
        --plugins stig,sans \
        -o standard-report.md
fi
```

## Performance Optimization

### Memory Management

```bash
# Set memory limits
opnFocus convert config.xml --max-memory 512MB

# Monitor memory usage
/usr/bin/time -v opnFocus convert config.xml

# Use streaming for large files
opnFocus convert large-config.xml --streaming
```

### Parallel Processing

```bash
# Process multiple files in parallel
find configs/ -name "*.xml" | xargs -P 4 -I {} \
    opnFocus convert {} -o docs/{}.md

# Batch processing with parallel execution
for config in configs/*.xml; do
    opnFocus convert "$config" -o "docs/$(basename "$config" .xml).md" &
done
wait
```

### Caching and Optimization

```bash
# Use template caching
opnFocus convert config.xml \
    --template-cache ~/.opnFocus/cache \
    --template standard

# Optimize for repeated processing
opnFocus convert config.xml \
    --optimize \
    --cache-dir ~/.opnFocus/cache
```

## Best Practices

### 1. Template Organization

```text
# Organize templates by purpose
~/.opnFocus/templates/
├── executive/
│   ├── summary.md.tmpl
│   └── dashboard.md.tmpl
├── technical/
│   ├── detailed.md.tmpl
│   └── network.md.tmpl
└── compliance/
    ├── stig.md.tmpl
    └── sans.md.tmpl
```

### 2. Configuration Management

```bash
# Use version control for configurations
git init ~/.opnFocus
cd ~/.opnFocus
git add .
git commit -m "Initial opnFocus configuration"

# Use environment-specific configs
export OPNFOCUS_CONFIG=~/.opnFocus/production.yaml
```

### 3. Template Development

```bash
# Test templates with sample data
opnFocus convert test-config.xml --template test-template

# Validate template syntax
opnFocus convert config.xml --template-dir ./templates --validate-templates

# Use template inheritance for consistency
# Base template -> Specialized templates
```

### 4. Performance Monitoring

```bash
# Monitor template rendering performance
opnFocus convert config.xml --template-dir ./templates --profile-templates

# Track memory usage
opnFocus convert config.xml --memory-profile

# Optimize based on usage patterns
opnFocus convert config.xml --optimize --cache-results
```

---

**Next Steps:**

- For basic documentation, see [Basic Documentation](basic-documentation.md)
- For audit and compliance, see [Audit and Compliance](audit-compliance.md)
- For automation, see [Automation and Scripting](automation-scripting.md)
