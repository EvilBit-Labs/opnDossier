<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configuration Diff Report</title>
<style>{{.CSS}}</style>
</head>
<body>
<h1>Configuration Diff Report</h1>

<div class="metadata">
  {{- if .Result.Metadata.OldFile}}
  <span><strong>Old:</strong> {{.Result.Metadata.OldFile}}</span>
  {{- end}}
  {{- if .Result.Metadata.NewFile}}
  <span><strong>New:</strong> {{.Result.Metadata.NewFile}}</span>
  {{- end}}
  {{- if not .Result.Metadata.ComparedAt.IsZero}}
  <span><strong>Compared:</strong> {{.Result.Metadata.ComparedAt.Format "2006-01-02 15:04:05"}}</span>
  {{- end}}
  {{- if .Result.Metadata.ToolVersion}}
  <span><strong>Version:</strong> {{.Result.Metadata.ToolVersion}}</span>
  {{- end}}
</div>

<div class="summary">
  <div class="summary-card added">
    <div class="count">{{.Result.Summary.Added}}</div>
    <div class="label">Added</div>
  </div>
  <div class="summary-card removed">
    <div class="count">{{.Result.Summary.Removed}}</div>
    <div class="label">Removed</div>
  </div>
  <div class="summary-card modified">
    <div class="count">{{.Result.Summary.Modified}}</div>
    <div class="label">Modified</div>
  </div>
  <div class="summary-card total">
    <div class="count">{{.Result.Summary.Total}}</div>
    <div class="label">Total</div>
  </div>
</div>

{{- if .Result.RiskSummary.HasRisks}}
<div class="risk-summary">
  <div class="risk-score">Security Risk Score: {{.Result.RiskSummary.Score}}</div>
  <div class="risk-badges">
    {{- if gt .Result.RiskSummary.High 0}}
    <span class="badge badge-high">{{.Result.RiskSummary.High}} High</span>
    {{- end}}
    {{- if gt .Result.RiskSummary.Medium 0}}
    <span class="badge badge-medium">{{.Result.RiskSummary.Medium}} Medium</span>
    {{- end}}
    {{- if gt .Result.RiskSummary.Low 0}}
    <span class="badge badge-low">{{.Result.RiskSummary.Low}} Low</span>
    {{- end}}
  </div>
</div>
{{- end}}

{{- if not .Result.HasChanges}}
<div class="no-changes">No changes detected between configurations.</div>
{{- else}}

<div style="margin-bottom: 1rem;">
  <button id="toggle-all" style="cursor:pointer; padding: 0.3rem 0.8rem; border-radius: 4px; border: 1px solid var(--border); background: var(--bg-surface); color: var(--text);">Collapse All</button>
</div>

{{- range $section, $changes := .BySection}}
<details class="section" open>
  <summary>{{capitalize $section}} ({{len $changes}} changes)</summary>
  <div class="section-content">
    <table class="changes-table">
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
          <th>Path</th>
          <th>Security</th>
          <th>Values</th>
        </tr>
      </thead>
      <tbody>
        {{- range $changes}}
        <tr class="change-{{.Type}}" data-type="{{.Type}}">
          <td><span class="badge badge-{{.Type}}">{{.Type}}</span></td>
          <td>{{.Description}}</td>
          <td class="value">{{.Path}}</td>
          <td>
            {{- if .SecurityImpact}}
            <span class="badge badge-{{.SecurityImpact}}">{{.SecurityImpact}}</span>
            {{- end}}
          </td>
          <td>
            {{- if .OldValue}}<div class="value value-old">- {{.OldValue}}</div>{{end}}
            {{- if .NewValue}}<div class="value value-new">+ {{.NewValue}}</div>{{end}}
          </td>
        </tr>
        {{- end}}
      </tbody>
    </table>
  </div>
</details>
{{- end}}
{{- end}}

<div class="footer">
  Generated by opnDossier{{if .Result.Metadata.ToolVersion}} v{{.Result.Metadata.ToolVersion}}{{end}}
</div>

<script>{{.JS}}</script>
</body>
</html>
